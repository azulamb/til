## V8の導入

Googleが作ったJavaScriptエンジンのV8をインストールして使えるようにします。

まずは周辺ツールの導入

```
git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
```

次に上のツールを使ってv8のリポジトリを持ってきます。

```sh
./depot_tools/v8
```

しばらく待つとv8ディレクトリが作られます。

次にビルドの準備をします。
なんか個別にLLVM持ってきてビルドして使おうとしているらしいのですが、それらの導入がうまく行かないのと、すでにLLVMを入れている場合複数あるのも無駄なので、次のように対処します。

```sh
cd v8
mkdir -p /third_party/llvm-build/Release+Asserts/
```

LLVM+clangを導入してない人は [https://github.com/HirokiMiyaoka/til/blob/master/LLVM/BuildWasm.md](ここ) 見ながら導入して、/usr/local/binにllvmやclangがある状態にしておきます。

今回のビルドではclang++が使われるようです。

では、次のようにしてシンボリックリンクを貼ります。

```sh
ln -s /usr/local/bin/ third_party/llvm-build/Release+Asserts/bin
```

これでビルド準備が整ったので、ビルドします。

```sh
make x64 wasm=on
```

途中で`SIZE_MAX`がないというエラーが出た場合。
多分何かの導入に失敗したものと思われますが、とりあえずリポジトリ内を探してそれっぽい記述を見つけたので以下のように追記します。おすすめしません。

```sh
vim src/compiler/instruction-selector.cc
```

includeの直下に以下を追記します。

```c
#ifndef SIZE_MAX
#define SIZE_MAX ((size_t) -1)
#endif
```

多分あってる。

途中で`INT64_MIN`がないというエラーが出た場合。
こちらも上同様。おすすめしないけどとりあえず値を入れます。

```sh
vim src/compiler/x64/code-generator-x64.cc
```

```c
#ifndef INT64_MIN
#define INT64_MIN -9223372036854775808.0
#endif
```

途中
