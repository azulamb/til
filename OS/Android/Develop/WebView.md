# WebView周りのメモ書き

## HTTPS対応

時間経過で自然と対応されていくので、記事にするのもなということでメモ書き。

### HTTPSのWebViewが表示されない（アクセスがそもそも遮断されて、Proxyで見てもアクセスが発生しない）ときに疑うこと

例えばあるAndroid端末だけHTTPSのページにアクセスできないとか、CharlesのProxyを通したときには正常に動くとか、そういう時にはまず以下を確認する。

* HTTPSとHTTPが混在していないかどうか
   * HTTPSのページ内でHTTPアクセスがあると、セキュリティが落ちるのでアクセスを遮断される（逆は可）。
* CharlesのSSL Proxy等を経由するとアクセスできるかどうか
   * CharlesのProxyに接続して証明書をAndroid端末にインストールすると、HTTPSの通信内容も見れるようになる。

もし後者の確認でアクセス可能だった場合、以下の記事にあるバグが関係している可能性がある。

http://itpro.nikkeibp.co.jp/atcl/idg/14/481542/120700306/?ST=cm-software&P=2

この戦いにより生じたバグで、「シマンテック及びシマンテック配下のSSL証明書を使っている」かつ以下のいずれかの条件を満たした端末では、WebViewでのHTTPSページの表示などができなくなる。

* システムWebViewのバージョンが53とか54
* Android 7.0 NougatでChromeのバージョンが53とか54
  * 7.0からはWebViewの機能をデフォルトではChromeが担当する。
  * 設定で変更可能らしいので、場合によってはそこで切り換えも可能だとか。
  * とにかく設定で利用しているWebViewがちゃんと想定されたものかの確認が必要。

対応は以下

* シマンテック配下以外のSSL証明書を使う
   * Rapid SSLなども配下だったりするので、どの系列か調べる。なんならChrome53や54などの用語を入れて調べる。
* WebViewおよびChromeを55以上にアップデート
* アプリ側にWebViewやChromeのバージョンチェック機構を入れてアップデートを促す（できるの？）
