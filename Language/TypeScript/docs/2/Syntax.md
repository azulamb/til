ブラッシュアップする

# JavaScriptの基本的な構文

ここではJavaScriptの基本的な構文について扱います。

# 結果を画面に出力

初めに、何をするにも自分のやったことが出力できなければ確認ができません。
プログラミング界隈では初めて各プログラムは文字列の画面への出力です。

画面の出力は以下のように行います。
実行方法で言うところのファイルでもコンソールでも何でも構いません。

```
console.log( 'Hello, world!' );
```

これで `Hello, world!` と画面上に表示されます。

`console.log( 表示したい何か )` で文字列として表示しようとしてくれます。

とりあえずこれはそのまま丸暗記で覚えてください。


# 宣言・定義

これから扱う変数や、一部の処理をまとめた関数と呼ばれるものは、宣言や定義と呼ばれる行為をする必要があります。

早い話、こういう名前の変数が存在するから！みたいなことを言わないといけないんだと思ってください。

ちなみに、上で出てきた `console.log` は、すでに皆さんが使えるようにデフォルトで宣言されています。

## 変数

変数とは、プログラミングにおいて値を入れておく箱であるとよく言われます。
箱に名前をつけて使えるようにすることを宣言、箱に値を入れることを代入と呼びます。

JavaScriptの変数は以下のように宣言して使います。

```
// test という変数を宣言して、Test string!! という文字列を代入する。
let test = "Test string!!";

// 画面に変数testに入っているものを表示する。
console.log( test );

// testに1という数値を代入する。
test = 1;

// 画面に変数testに入っているものを表示する。
console.log( test );
```

`console.log( 表示したいデータもしくは変数 )` で画面に文字を出力してくれます。
結果は次のようになります。

```
Test string!!
1
```

`let` が変数の宣言に使われるもので、`let 変数名` で変数を宣言できます。
JavaScriptでは宣言されてない変数や定義されていない関数をそのまま使おうとするとエラーになります。

```
// これだけだとエラー
console.log( test );
```

型についての話でも述べますが、JavaScriptの変数には何でも入れることが出来ます。

変数の宣言や具体的な特徴については次の [変数とスコープ](Variable.md) にて扱います。

### 配列

変数には一部特殊な構造を持ったものがあります。

まずよく使うのは配列です。
配列は変数を一列に並べて、配列のn番目にアクセスする、という使い方ができます。

```
const list = [ 10, 20, 30 ];
console.log( list[ 0 ] ); // listの0番目にある値=10を表示
list[ 1 ] = 40;           // listの1番目の値を40にする
console.log( list[ 1 ] ); // listの0番目にある値=40を表示
```

この配列のn番目(nは0から始まり連番)は添字と呼ばれます。

配列には何でも入れることができる一方、それが何者かわからず苦労することもある他、様々な罠が潜んでいます。使うときは気をつけましょう。

### オブジェクト

配列は値を連続して並べるため、数値を元に値を探すことができます。
しかし、JavaScriptには他にも便利なデータ構造があります。
それがこのオブジェクトです。

こちらは文字列のキーと値がセットになったものです。

```
const obj = { a: 10 };
console.log( obj.a );      // objのaというキーにある値=10を表示
obj.b = 20;                // objに20という値をbというキーとセットにして入れる。
conosle.log( obj.b );      // objのbというキーにある値=20を表示
const key = 'a';           // 変数にキー名を入れておく。
console.log( obj[ key ] ); // keyという変数の中には a という文字列があり、objの中のaのキーに対応する値=10を表示
```

基本的には `オブジェクトの変数名.キー名` もしくは `オブジェクトの変数名[ キー名(最終的に文字列にしてから使う) ]` で値にアクセスできます。
例えば上の例なら `obj[ 'a' ]` という書き方もできますが、キー名が固定で分かっているなら `obj.a` の方がわかりやすいでしょう。
ただしキー名が変数に入っている場合は、配列同様の書き方をする必要があります。

オブジェクトは非常に柔軟で複雑な構造を作ることができるので、様々な場面で使うことがあるでしょう。

## 関数

関数とはある一定の処理を固めて、他の場所から呼び出せるようにしたものだと思えばよいです。

以下みたいな感じで定義したり呼び出せます。

```
// 関数定義
function func() {
    console.log( 'FUNCTION!!!' );
}
// 関数呼び出し
func();
```

他にも以下のように変数に関数を入れることも可能です。

```
const func = function() {
    console.log( 'FUNCTION!!!' );
};
func();
```

書き方としては関数名が消えた（無名関数になった）ところが変わったくらいで、呼び出し方は変わりませんね。
とにかくJavaScriptでは関数もしくは関数の入った変数であれば、このように呼び出すことが出来ます。

また、先程の例のように関数に名前をつけずに定義することもできる手軽さから、JavaScriptにはコールバックという文化が根づいています。

例えば有名なのは、ブラウザで以下のようにしてクリックされた時のイベントを登録する方法でしょう。

```
document.getElementById( 'send' ).addEventListener( 'click', function() {
    console.log( 'button click!' );
}, false );
```

これは、以下のようなHTMLで書かれたボタンがクリックした時に実行されます。

```
<button id+"send">Send</button>
```

### 新しい関数の書き方

実は `function` による関数定義は、 変数の `var` 同様若干クセがあります。

そこで、最近では新しい関数の定義方法が出てきました。

```
const func = () => {
    console.log( 'FUNCTION!!!' );
};
document.getElementById( 'send' ).addEventListener( 'click', () => {
    console.log( 'button click!' );
}, false );
```

この書き方をアロー関数式と呼ぶようです。
特徴としては関数式なので普通の関数のように名前付きで定義できないため、すべて無名関数になります。

過激派は全て新しい書き方で書くべきだ！みたいに言うこともありますが、個人的には関数名を指定して書けず、変数に入れる必要があるのが面倒だなと感じます。
なので、個人的には普通の関数定義では `function` を使い、それ以外の変数やコールバック関数に入れるとかそういうケースではアロー関数式を使っています。

特に、`function` の独特のクセは `this` の中身に関するものなので、関数内部で `this` さえ使わない独立した処理ならば、名前も定義できるのでこちらの方が良いかもしれません。
しかし、`this` を使うケースでは利用が難しいケースも多々ありますので、このアロー関数式を使うようにしたほうが良いでしょう。

## 即時関数

JavaScriptでは定義即実行という書き方もあります。

```
(function() { 処理内容 })();
(() => { 処理内容 })();
```

一瞬見慣れないですが、以下のような手順で見ると何をしているか分かると思います。

```
function func() { 処理内容 }
func();
```

```
const func = function() { 処理内容 }
func();
```

```
const func = function() { 処理内容 }
( func )();
```

```
( function() { 処理内容 } )();
```

# ブロック

一定の処理をブロックという単位で固めることが出来ます。
最も分かりやすいのは関数でしょう。

```
function func() {
    処理
}
```

関数は処理を `{}` でグループ化しているようなものです。この `{}` で処理をグループ化して固めた領域をブロックと呼びます。

これから下でどんどん使います。

# 条件分岐

条件分岐は、条件によって処理を変える構文になります。

```
const age = 18;
if ( age < 20 ) {
    console.log( '未成年です！' );
}
```

`age` にはその人の年令が入っているとして、それが `20` より小さければ、未成年ということになります。
このプログラムは未成年のときだけ `未成年です！` と表示してくれます。

`age` を `20` などにすると

このように、条件分岐（if文）は、条件が成立したときだけそれに続くブロック内の処理を実行してくれます。

ちなみに、`age < 20` は条件式と呼ばれ、計算式( `1 + 1` とか )と同じ仲間なので、変数に代入することも可能です。

## その他など

とりあえずif文が分かっている前提で一番複雑な状態を書いておきます。

```
if ( 条件式1 ) {
    // 条件式1を満たした場合の処理
} else if ( 条件式2 ) {
    // 条件式1を満たさず、条件式2を満たした場合の処理
} else {
    // 条件式1と2を両方満たさなかったその他の場合の処理
}
```

# ループ

条件を満たす間延々と処理を繰り返すことをループと読んだりしますが、その構文が以下です。

```
let count - 10;
while( 0 < count ) {
    console.log( count ); // カウントを表示
    --count; // カウントを1減らす
}
console.log( '0!!!' );
```

これはカウントダウンをするループです。丁寧に書くと以下のようになります。

* countに10を入れる。
* count(中身は10)は0より大きいので、ブロックの中の処理を行う(1ループ目開始)
    * countを表示(10が出力される)
    * countから1を引く(9になる)
    * 処理が終わったのでブロック開始位置（whileのところ）まで戻る。
* count(中身9)は0より大きいので、ブロックの中の処理を行う(2ループ目開始)
    * countを表示(9が出力される)
    * countから1を引く(8になる)
    * 処理が終わったので始めに戻る
* 省略
* count(中身は1)は0より大きいので、ブロックの中の処理を行う(10ループ目開始)
    * countを表示(9が出力される)
    * countから1を引く(0になる)
    * 処理が終わったので始めに戻る
* count(中身は0)は0より大きくないので、11ループ目は開始せず、ブロックの次の行まで進む
* 0!!!を出力して終了

このように同じ処理を何度も繰り返しますが、その条件となる部分を繰り返す処理の中で変化させていくことで、カウントダウンを行っています。

ちなみに、このように変化させない場合、ループ判定のための条件式を延々と成立させてしまうことで、無限ループを発生させることがあります。
これを発生させるとCPUの処理を一気に使い、PCが重くなったりするので注意しましょう。

## for

今回のようなカウントダウンやカウントアップのように、回数指定のループであれば `for` を使うとスッキリ書けます。

```
for ( let count = 0 ; count < 10 ; ++count ) {
    console.log( count );
}
```

今度は0から9までの10回ループを行うループです。
`while`では条件式を書いていたところが、`( 初めに1回実行されるところ ; 条件式 ; ブロック終了後に実行されるところ )` の3箇所に別れています。

回数が決まっている場合はこちらの方が楽なので、`for` を使いましょう。

## 配列に対するループ

配列の中身をすべて取り出して表示であれば、以下のようなループが書けるでしょう。

```
const list = [ 10, 20, 30 ];
for ( let i = 0 ; i < list.length ; ++i ) {
    console.log( list[ i ] );
}
```

しかし配列であれば、以下のような書き方も可能です。

```
for ( let i in list ) {
    console.log( list[ i ] );
}
```

`for...in` というものと使うと、上のように `i` に添え字がはいるので、上のforの時同様に実行されます。

値だけであれば、`for...of`を使うことで取得も可能です。

```
for( let value of list ) {
    console.log( value );
}
```

また、配列には組み込みの関数(メソッド)が用意されているので、以下のように値をそのまま取得することも可能です。

```
list.forEach( ( value, index, array ) => {
    console.log( value );
} );
```

`forEach` は関数を登録し、その関数に `( 値, 添字, listと同じ配列 )` が渡されます。今回であれば `( value => {} )` のように1つだけ受け取るような形で実装して構いません。

### 配列もどき

JavaScriptの配列は、挙動だけ見ればキー名が連番の数値として作られたオブジェクトと大差ありません。
つまり、以下のようなものも配列みたいに扱えます。

```
const list = {
  0: 10,
  1: 20,
  2: 30,
  length: 3,
};
```

これは `length` もあるので、初めのforループで配列と同じように値を取得することが可能です。
しかし、このオブジェクトには `forEach` がないので、`forEach` は使うことが出来ません。for...in
`for...in` はデフォルト以外のキーをすべて取得するので上の場合 `length` まで対象に入ったり、`for...of` はそもそも使えないとエラーが出たり散々です。

このように、配列のフリをした配列もどきのオブジェクトが、JavaScriptにはよくあります。
（例えばブラウザJSなら、HTML要素が持つ子要素の `children` は一見配列のように見えるが配列もどきのため、`for`ループは使えるが、`forEach`は使えない。）

今扱っているデータが何者なのかはっきりさせて使うようにしましょう。

なお、TypeScriptは配列か配列でないかをちゃんと判別できるので、`forEach` が使えないのに使おうとしたらエラーになります。
