# 4方向

## 乱数からの方向

rが0-4(上右下左)で来たとき、xとyにそれぞれ+1か-1をする。具体的には以下のような対応関係。

| r | x | y |意味|
|---|---|---|----|
| 0 | x |y-1| 上 |
| 1 |x+1| y | 右 |
| 2 | x |y+1| 下 |
| 3 |x-1| y | 左 |

```
x + ( 2 - r ) * ( r % 2 )
y + ( r - 1 ) * ( ( r + 1 ) % 2 ) )
```

## キャラの方向

上下左右の入力から、0-3の方向番号に変換するやつ。8方向も入れておくか

どこかに処理があったので引っ張ってくる

# 8方向

```
 1
8 2
 4
```

このようなbitが立つとすると、以下になる。

```
 9 1 3
 8   2
12 4 6
```

## 方向の数字からxとyを分離

例えば3なら、`x=1`、`y=-1`に分離する

なお3方向の場合などは上下などのセット部分を無効化して残った値になる。つまり15は全方向入力なので0になる。

```
sx = floor( direction < 8 ? ( direction % 4 ) / 2 : ( direction % 4 ) / 2  - 1  );
sy = ( direction % 8 ) < 4 ? -( direction % 2 ) : ( direction + 1 ) % 2;
```

floorは小数点以下切り捨て関数。整数が使えるなら不要。

# 3属性

例えば`R=0` `G=1` `B=2` で、`R > G > B > R` という相性があったとします。

同じ属性は0、弱点は1、弱点じゃない場合は-1としたときの相性表は以下です。

| D\A | R | G | B |
|---|---|---|----|
| R | 0 | -1 | 1 |
| G | 1 | 0 | -1 |
| B | -1 | 1 | 0 |

この時Dを防御側、Aを攻撃側とした時にこの表の数値を出す式。

```
( 4 - A + D ) % 3 - 1
```

ざっくり導出。

* `( 3 + ( A - D ) ) % 3`
  * この式で相性が-1の場合は1、0の場合は0、1の場合は2という答えに収束する。
* `( 4 -上の答え ) % 3`
  * この式で相性が-1の場合は0、0の場合は1、1の場合は2という答えに収束する。
* 後は上の答えに-1すれば-1～1になる。
* これを整理する。
  * 余りの計算をしない時、一番上の式は相性が-1の場合は1か4、0の場合は3、1の場合は2か5になる。
  * 負の数にならないように二番目の式の4に3を足した状態で計算を行う。
    * `( 7 - 上の答え )`
    * 余りの計算をしない時、-1の場合は3か6、0の場合は4、1の場合は2か5になる。
    * 3で割った余りはそれぞれ0,1,2となる。
  * うまくいきそうなので整理する。
    * `( 4 + 3 - ( 3 + A - D ) ) % 3 - 1`
    * `( 4 - A + D ) %3 - 1`
